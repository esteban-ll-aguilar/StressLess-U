{% extends "layouts/base_Proyect.html" %}

{% block title %} {{ _('Documentación - Google Forms') }} {% endblock %}

{% block inner_content %}
<div class="pcoded-content">
    <div class="pcoded-inner-content">
        <div class="main-body">
            <div class="page-wrapper">
                <!-- [ breadcrumb ] start -->
                <div class="page-header">
                    <div class="page-block">
                        <div class="row align-items-center">
                            <div class="col-md-12">
                                <div class="page-header-title">
                                    <h5 class="m-b-10">{{ _('Documentación de Google Forms') }}</h5>
                                </div>
                                <ul class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="/"><i class="feather icon-home"></i></a></li>
                                    <li class="breadcrumb-item"><a href="{{ url_for('documentation.index') }}">{{ _('Documentación') }}</a></li>
                                    <li class="breadcrumb-item active">{{ _('Google Forms') }}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- [ breadcrumb ] end -->

                <!-- [ Main Content ] start -->
                <div class="row">
                    <!-- Navegación Lateral -->
                    <div class="col-md-3">
                        <div class="card sticky-top" style="top: 85px;">
                            <div class="card-body">
                                <h5>{{ _('Contenido') }}</h5>
                                <div class="nav flex-column nav-pills" role="tablist">
                                    <a class="nav-link active" href="#overview">{{ _('Descripción General') }}</a>
                                    <a class="nav-link" href="#setup">{{ _('Configuración Inicial') }}</a>
                                    <a class="nav-link" href="#notifications">{{ _('Sistema de Notificaciones') }}</a>
                                    <a class="nav-link" href="#apps-script">{{ _('Apps Script') }}</a>
                                    <a class="nav-link" href="#troubleshooting">{{ _('Solución de Problemas') }}</a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Contenido Principal -->
                    <div class="col-md-9">
                        <!-- Descripción General -->
                        <div class="card" id="overview">
                            <div class="card-header">
                                <h5>{{ _('Descripción General') }}</h5>
                            </div>
                            <div class="card-body">
                                <p class="lead">
                                    {{ _('El sistema de notificaciones automáticas utiliza Google Forms y Apps Script para monitorear las respuestas de los estudiantes y enviar alertas cuando se detectan niveles altos de estrés.') }}
                                </p>
                                <div class="alert alert-info">
                                    <h6><i class="feather icon-info mr-2"></i>{{ _('Características Principales') }}</h6>
                                    <ul class="mb-0">
                                        <li>{{ _('Notificaciones automáticas por correo electrónico') }}</li>
                                        <li>{{ _('Análisis de respuestas en tiempo real') }}</li>
                                        <li>{{ _('Configuración personalizable de umbrales') }}</li>
                                        <li>{{ _('Integración con Google Forms') }}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Configuración Inicial -->
                        <div class="card" id="setup">
                            <div class="card-header">
                                <h5>{{ _('Configuración Inicial') }}</h5>
                            </div>
                            <div class="card-body">
                                <div class="mb-4">
                                    <h6>{{ _('1. Requisitos Previos') }}</h6>
                                    <ul>
                                        <li>{{ _('Cuenta de Google activa') }}</li>
                                        <li>{{ _('Permisos para crear y editar formularios') }}</li>
                                        <li>{{ _('Acceso a Google Apps Script') }}</li>
                                    </ul>
                                </div>

                                <div class="mb-4">
                                    <h6>{{ _('2. Estructura del Formulario') }}</h6>
                                    <div class="alert alert-warning">
                                        <strong>{{ _('Importante:') }}</strong>
                                        {{ _('Para que el sistema funcione correctamente, asegúrate de:') }}
                                        <ul class="mb-0">
                                            <li>{{ _('Usar preguntas con escala de 0-4') }}</li>
                                            <li>{{ _('Habilitar la recopilación de correos electrónicos') }}</li>
                                            <li>{{ _('Mantener un formato consistente en las preguntas') }}</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Sistema de Notificaciones -->
                        <div class="card" id="notifications">
                            <div class="card-header">
                                <h5>{{ _('Sistema de Notificaciones') }}</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>{{ _('Flujo de Trabajo') }}</h6>
                                        <ol>
                                            <li>{{ _('El estudiante completa el formulario') }}</li>
                                            <li>{{ _('El sistema calcula el nivel de estrés') }}</li>
                                            <li>{{ _('Si supera el umbral, se envía una notificación') }}</li>
                                            <li>{{ _('El docente recibe un correo detallado') }}</li>
                                        </ol>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="alert alert-success">
                                            <h6>{{ _('Ejemplo de Notificación') }}</h6>
                                            <p><strong>{{ _('Asunto:') }}</strong> {{ _('Alerta: Resultado Bajo en Test de Estrés') }}</p>
                                            <p><strong>{{ _('Contenido:') }}</strong></p>
                                            <ul class="mb-0">
                                                <li>{{ _('Estudiante: ejemplo@email.com') }}</li>
                                                <li>{{ _('Puntuación: {}').format('75%') }}</li>
                                                <li>{{ _('Fecha: {}').format('05/02/2025') }}</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                                <div class="alert alert-info mt-4">
                                    <h6>{{ _('Niveles de Estrés') }}</h6>
                                    <ul class="mb-0">
                                        <li><strong>{{ _('Crítico:') }}</strong> {{ _('Mayor o igual a {}').format('80%') }}</li>
                                        <li><strong>{{ _('Alto:') }}</strong> {{ _('Entre {} y {}').format('60%', '79%') }}</li>
                                        <li><strong>{{ _('Medio:') }}</strong> {{ _('Entre {} y {}').format('40%', '59%') }}</li>
                                        <li><strong>{{ _('Bajo:') }}</strong> {{ _('Menor a {}').format('40%') }}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Apps Script -->
                        <div class="card" id="apps-script">
                            <div class="card-header">
                                <h5>{{ _('Apps Script') }}</h5>
                            </div>
                            <div class="card-body">
                                <p>{{ _('El sistema utiliza Google Apps Script para procesar las respuestas y enviar notificaciones automáticamente.') }}</p>
                                
                                <div class="alert alert-info mb-4">
                                    <h6>{{ _('Funcionalidades del Script:') }}</h6>
                                    <ul class="mb-0">
                                        <li>{{ _('Procesamiento de respuestas en tiempo real') }}</li>
                                        <li>{{ _('Cálculo automático de puntuaciones') }}</li>
                                        <li>{{ _('Envío de notificaciones personalizadas') }}</li>
                                        <li>{{ _('Registro de resultados') }}</li>
                                    </ul>
                                </div>

                                <div class="bg-light p-3 rounded">
                                    <h6>{{ _('Ejemplo de Código:') }}</h6>
                                    <pre class="mb-0"><code>function onFormSubmit(e) {
  var formResponse = e.response;
  var score = calculateScore(formResponse);
  
  if (score < 60) {
    sendNotification(formResponse, score);
  }
}</code></pre>
                                </div>
                            </div>
                        </div>

                        <!-- Solución de Problemas -->
                        <div class="card" id="troubleshooting">
                            <div class="card-header">
                                <h5>{{ _('Solución de Problemas') }}</h5>
                            </div>
                            <div class="card-body">
                                <div class="accordion" id="troubleshootingAccordion">
                                    <!-- Problema 1 -->
                                    <div class="card border mb-1">
                                        <div class="card-header" id="headingOne">
                                            <h2 class="mb-0">
                                                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne">
                                                    {{ _('No recibo notificaciones') }}
                                                </button>
                                            </h2>
                                        </div>
                                        <div id="collapseOne" class="collapse" data-parent="#troubleshootingAccordion">
                                            <div class="card-body">
                                                <ol>
                                                    <li>{{ _('Verifica que el formulario esté recopilando correos') }}</li>
                                                    <li>{{ _('Comprueba los permisos del script') }}</li>
                                                    <li>{{ _('Revisa la configuración de notificaciones') }}</li>
                                                </ol>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Problema 2 -->
                                    <div class="card border mb-1">
                                        <div class="card-header" id="headingTwo">
                                            <h2 class="mb-0">
                                                <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseTwo">
                                                    {{ _('Error al calcular puntuaciones') }}
                                                </button>
                                            </h2>
                                        </div>
                                        <div id="collapseTwo" class="collapse" data-parent="#troubleshootingAccordion">
                                            <div class="card-body">
                                                <ol>
                                                    <li>{{ _('Verifica el formato de las preguntas') }}</li>
                                                    <li>{{ _('Asegúrate de usar la escala correcta (0-4)') }}</li>
                                                    <li>{{ _('Revisa el código de cálculo de puntuaciones') }}</li>
                                                </ol>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="alert alert-warning mt-4">
                                    <h6 class="alert-heading">{{ _('¿Necesitas más ayuda?') }}</h6>
                                    <p class="mb-0">{{ _('Si los problemas persisten, contacta a nuestro equipo de soporte o consulta la documentación detallada de Google Forms.') }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- [ Main Content ] end -->
            </div>
        </div>
    </div>
</div>
{% endblock inner_content %}

{% block javascripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelector('#menu-documentation').classList.add('active');
        
        // Smooth scroll para navegación
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                window.scrollTo({
                    top: targetElement.offsetTop - 100,
                    behavior: 'smooth'
                });
            });
        });

        // Activar link según scroll
        window.addEventListener('scroll', function() {
            const sections = document.querySelectorAll('.card[id]');
            let currentSection = '';

            sections.forEach(section => {
                const sectionTop = section.offsetTop - 120;
                if (window.pageYOffset >= sectionTop) {
                    currentSection = section.getAttribute('id');
                }
            });

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + currentSection) {
                    link.classList.add('active');
                }
            });
        });
    });
</script>
{% endblock javascripts %}
